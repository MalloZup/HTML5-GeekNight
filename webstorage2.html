<!DOCTYPE html>
<html>
  <head>
    <title>Web Storage</title>
    <link href='css/common.css' rel='stylesheet' type='text/css' />
    <link href='css/webstorage.css' rel='stylesheet' type='text/css' />
    <script type='text/javascript'>
      //<![CDATA[
        function init() {
          addEventListener('storage', function(e) {
            //alert("Change");
            var changes = document.querySelector("div.changes > pre");
            changes.innerHTML += e.key + " : " + e.oldValue + " -> " + e.newValue + " (" + e.url + ")\n";
          }, false);
        }
      //]]>
    </script>
  </head>
  <body onload='init();'>
    <section>
      <div class='set'>
        <input class='key' type='text' />
        <input class='value' type='text' />
        <button>Set</button>
      </div>
      <div class='get'>
        <input type='text' />
        <button>Get</button>
        <span></span>
      </div>
      <div class='remove'>
        <input type='text' />
        <button>Remove</button>
      </div>
      <div class='clear'>
        <button>Clear</button>
      </div>
      <div class='all'>
        <button>All</button>
        <pre></pre>
      </div>
      <div class='changes'>
        <label>Changes</label>
        <pre></pre>
      </div>
      <footer>
        <ul>
          <li>
            <a href='http://dev.w3.org/html5/webstorage/'>Spec</a>
          </li>
          <li>
            <a href='http://diveintohtml5.org/storage.html'>Dive Into HTML5</a>
          </li>
        </ul>
      </footer>
    </section>
    <script type='text/javascript'>
      //<![CDATA[
        var setKey = document.querySelector("div.set > input.key");
        var setValue = document.querySelector("div.set > input.value");
        var getKey = document.querySelector("div.get > input");
        var getValue = document.querySelector("div.get > span");
        var removeKey = document.querySelector("div.remove > input");
        var all = document.querySelector("div.all > pre");
        document.querySelector("div.set > button").addEventListener('click', function() {
          localStorage.setItem(setKey.value, setValue.value);
        }, false);
        document.querySelector("div.get > button").addEventListener('click', function() {
          getValue.innerHTML = localStorage.getItem(getKey.value);
        }, false);
        document.querySelector("div.remove > button").addEventListener('click', function() {
          localStorage.removeItem(removeKey.value);
        }, false);
        document.querySelector("div.clear > button").addEventListener('click', function() {
          localStorage.clear();
        }, false);
        document.querySelector("div.all > button").addEventListener('click', function() {
          all.innerHTML = "";
          for (var i = 0; i < localStorage.length; i++) {
            var key = localStorage.key(i);
            all.innerHTML += key + " : " + localStorage.getItem(key) + "\n";
          }
        }, false);
      //]]>
    </script>
  </body>
</html>
